<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Muggle’s Guide to Lenormand</title>

  <!-- 🪄 Open Graph -->
  <meta property="og:title" content="The Muggle’s Guide to Lenormand">
  <meta property="og:description" content="마법 없는 세상의 마법사들을 위한 하루의 오라클 ✨">
  <meta id="ogImage" property="og:image" content="https://hie552.github.io/the-muggles-guide-to-lenormand/mgl_b_gr.png">
  <meta id="ogUrl" property="og:url" content="https://hie552.github.io/the-muggles-guide-to-lenormand/">
  <meta property="og:type" content="website">
  <meta name="theme-color" content="#2e2a4b">

  <style>
    @font-face {
      font-family: 'HarryPotter';
      src: url('HarryPotterDemoRegular.ttf') format('truetype');
    }

    body {
      margin: 0;
      padding: 0;
      height: 100vh;
      background: url('background_0.png') no-repeat center center/cover;
      font-family: 'HarryPotter', serif;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #f4e9d8;
      text-align: center;
      overflow: hidden;
    }

    .container {
      position: relative;
      z-index: 10;
      max-width: 500px;
    }

    h1 {
      font-size: 2rem;
      letter-spacing: 2px;
      text-shadow: 0 0 10px rgba(255,255,255,0.4);
    }

    .card {
      width: 250px;
      height: 400px;
      perspective: 1000px;
      margin: 20px auto;
      cursor: pointer;
    }

    .card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transition: transform 0.8s;
      transform-style: preserve-3d;
    }

    .card.flipped .card-inner {
      transform: rotateY(180deg);
    }

    .card-front, .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0,0,0,0.4);
    }

    .card-back {
      background: url('mgl_b_gr.png') no-repeat center center/contain;
      background-color: rgba(20, 20, 20, 0.3);
    }

    .card-front {
      transform: rotateY(180deg);
      background-color: #1f1c2e;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 10px;
    }

    .card-front img {
      width: 100%;
      border-radius: 10px;
    }

    .message {
      margin-top: 15px;
      padding: 15px;
      border-radius: 8px;
      background: rgba(255,255,255,0.1);
      font-size: 0.95rem;
      line-height: 1.4;
      text-shadow: 0 0 5px rgba(255,255,255,0.2);
    }

    button {
      font-family: 'HarryPotter';
      font-size: 1rem;
      color: #fff;
      background: #4a3e7b;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      margin: 10px;
      transition: 0.3s;
    }

    button:hover {
      background: #6a56c2;
    }

    #sparkles {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      pointer-events: none;
    }

    .sparkle {
      position: absolute;
      width: 5px;
      height: 5px;
      background: gold;
      border-radius: 50%;
      animation: sparkle 1.5s linear forwards;
    }

    @keyframes sparkle {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(-50px) scale(0.5); }
    }
  </style>
</head>
<body>
  <div id="sparkles"></div>
  <div class="container">
    <h1>The Muggle’s Guide to Lenormand</h1>

    <div class="card" id="card">
      <div class="card-inner" id="cardInner">
        <div class="card-back"></div>
        <div class="card-front" id="cardFront">
          <img id="cardImage" src="" alt="">
          <div class="message" id="cardMeaning">
            <h3 id="cardTitle"></h3>
            <p id="cardKeywords"></p>
            <p id="cardDescription"></p>
          </div>
        </div>
      </div>
    </div>

    <button id="drawButton">오늘의 카드 보기</button>
    <button id="shareButton" style="display:none;">🔮 카카오톡으로 공유</button>
    <button id="redrawButton" style="display:none;">다시 뽑기</button>
  </div>

  <script>
    const baseURL = "https://hie552.github.io/the-muggles-guide-to-lenormand/";

    const cards = [
      { num: '01', name: 'RIDER', image: '01_RIDER.png',
        keywords: '소식, 방문자, 새로운 시작',
        meaning: '좋은 소식이나 새로운 기회가 빠르게 다가오고 있습니다. 해그리드처럼 예상치 못한 방문자나 메시지를 받을 수 있습니다. 모험이 당신을 기다리고 있어요!' },
      { num: '02', name: 'CLOVER', image: '02_CLOVER.png',
        keywords: '행운, 기회, 단기간의 행복',
        meaning: '펠릭스 펠리시스(행운의 물약)처럼 작지만 확실한 행운이 찾아옵니다. 기회를 놓치지 마세요. 긍정적인 태도가 더 큰 행운을 불러옵니다!' }
    ];

    const params = new URLSearchParams(window.location.search);
    const cardParam = params.get('card');

    const card = document.getElementById('card');
    const cardImage = document.getElementById('cardImage');
    const cardTitle = document.getElementById('cardTitle');
    const cardKeywords = document.getElementById('cardKeywords');
    const cardDescription = document.getElementById('cardDescription');
    const drawButton = document.getElementById('drawButton');
    const shareButton = document.getElementById('shareButton');
    const redrawButton = document.getElementById('redrawButton');
    const sparklesContainer = document.getElementById('sparkles');

    let currentCard = null;

    function createSparkles() {
      for (let i = 0; i < 30; i++) {
        setTimeout(() => {
          const sparkle = document.createElement('div');
          sparkle.className = 'sparkle';
          sparkle.style.left = Math.random() * 100 + '%';
          sparkle.style.top = Math.random() * 100 + '%';
          sparklesContainer.appendChild(sparkle);
          setTimeout(() => sparkle.remove(), 1500);
        }, i * 50);
      }
    }

    function drawCard(selected = null) {
      createSparkles();
      const randomCard = selected || cards[Math.floor(Math.random() * cards.length)];
      currentCard = randomCard;

      cardImage.src = randomCard.image;
      cardTitle.textContent = `${randomCard.num}. ${randomCard.name}`;
      cardKeywords.textContent = randomCard.keywords;
      cardDescription.textContent = randomCard.meaning;

      card.classList.add('flipped');
      drawButton.style.display = 'none';
      shareButton.style.display = 'inline-flex';
      redrawButton.style.display = 'inline-flex';

      // Open Graph 이미지/URL 업데이트
      document.querySelector('#ogImage').setAttribute('content', baseURL + randomCard.image);
      document.querySelector('#ogUrl').setAttribute('content', `${baseURL}?card=${randomCard.num}`);
    }

    function redrawCard() {
      card.classList.remove('flipped');
      drawButton.style.display = 'inline-block';
      shareButton.style.display = 'none';
      redrawButton.style.display = 'none';
      setTimeout(() => drawCard(), 400);
    }

    shareButton.addEventListener('click', () => {
      const shareUrl = `${baseURL}?card=${currentCard.num}`;
      const shareText =
        `🪄 오늘의 오라클: ${currentCard.name}\n${currentCard.keywords}\n\n${currentCard.meaning}\n\n✨ ${shareUrl}`;

      if (navigator.share) {
        navigator.share({
          title: "The Muggle’s Guide to Lenormand",
          text: shareText,
          url: shareUrl
        });
      } else {
        navigator.clipboard.writeText(shareText).then(() => {
          alert("결과가 복사되었습니다! 카카오톡에 붙여넣기 해보세요 💫");
        });
      }
    });

    drawButton.addEventListener('click', () => drawCard());
    redrawButton.addEventListener('click', redrawCard);

    // 주소에 ?card=번호 있을 때 자동 표시
    if (cardParam) {
      const selectedCard = cards.find(c => c.num === cardParam);
      if (selectedCard) drawCard(selectedCard);
    }
  </script>
</body>
</html>
